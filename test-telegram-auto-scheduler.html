<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Telegram Auto-Scheduler</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .test-section h3 {
            color: #007bff;
            margin-top: 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .success {
            border-left-color: #28a745;
        }
        .success h3 {
            color: #28a745;
        }
        .warning {
            border-left-color: #ffc107;
        }
        .warning h3 {
            color: #856404;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 Test Telegram Auto-Scheduler</h1>
        
        <div class="test-section">
            <h3>📋 Fitur Yang Sudah Diimplementasi</h3>
            <ul>
                <li>✅ Auto-schedule saat admin buat renungan dengan tanggal</li>
                <li>✅ UI kolom "Telegram" dengan status terjadwal/belum</li>
                <li>✅ Tombol schedule/unschedule manual</li>
                <li>✅ Background scheduler service</li>
                <li>✅ Cron job script untuk server</li>
                <li>✅ Fixed Telegram API conflicts (polling disabled)</li>
            </ul>
        </div>

        <div class="test-section success">
            <h3>🚀 Cara Testing</h3>
            <ol>
                <li><strong>Buka Admin Dashboard</strong>:
                    <div class="code-block">http://localhost:8080/admin/renungan</div>
                </li>
                <li><strong>Tambah Renungan Baru</strong>:
                    - Klik "Tambah Renungan"<br>
                    - Isi form dengan tanggal (contoh: 30/08/2025)<br>
                    - Klik "Simpan"<br>
                    - ✅ Harus ada notifikasi "dijadwalkan untuk dikirim otomatis"
                </li>
                <li><strong>Cek Tabel</strong>:
                    - Kolom "Telegram" harus show "🕒 Terjadwal"<br>
                    - Tombol aksi harus show 📅❌ (unschedule) bukan 📅 (schedule)
                </li>
                <li><strong>Test Manual Schedule</strong>:
                    - Untuk renungan tanpa tanggal: klik 📅 (schedule)<br>
                    - Untuk renungan terjadwal: klik 📅❌ (unschedule)
                </li>
            </ol>
        </div>

        <div class="test-section warning">
            <h3>⚠️ Testing Background Scheduler</h3>
            <p><strong>Console Test</strong>:</p>
            <div class="code-block">
// Buka Console browser (F12)
// Import dan test scheduler
import backgroundScheduler from '/src/services/backgroundScheduler.js'

// Check status
console.log(backgroundScheduler.getStatus())

// Manual trigger
await backgroundScheduler.triggerManual()

// Start scheduler (development)
backgroundScheduler.start()
            </div>
        </div>

        <div class="test-section">
            <h3>🔧 Server-side Testing</h3>
            <p><strong>Test Cron Script</strong>:</p>
            <div class="code-block">
# Windows PowerShell
.\run-telegram-scheduler.ps1

# atau Node.js direct
node scripts/run-telegram-scheduler.js
            </div>
        </div>

        <div class="test-section">
            <h3>📱 Expected Behavior</h3>
            <ul>
                <li><strong>Auto-Schedule</strong>: Renungan dengan tanggal 28/08/2025 → dijadwalkan kirim 28/08/2025</li>
                <li><strong>UI Update</strong>: Status berubah dari "Belum dijadwalkan" → "🕒 Terjadwal"</li>
                <li><strong>Manual Control</strong>: Admin bisa schedule/unschedule kapan saja</li>
                <li><strong>Background Process</strong>: Setiap hari cek schedule, kirim yang sesuai tanggal</li>
                <li><strong>No Conflicts</strong>: Tidak ada error Telegram API "getUpdates conflict"</li>
            </ul>
        </div>

        <div id="testResults" class="test-section">
            <h3>🧪 Quick Tests</h3>
            <button class="btn" onclick="testTelegramService()">Test Telegram Service</button>
            <button class="btn" onclick="testSchedulerService()">Test Scheduler Service</button>
            <button class="btn" onclick="testFirebaseConnection()">Test Firebase</button>
            <div id="testOutput"></div>
        </div>
    </div>

    <script>
        // Quick test functions
        async function testTelegramService() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<div class="status">Testing Telegram Service...</div>';
            
            try {
                // Test if TelegramService can be imported (basic check)
                const response = await fetch('/src/services/telegramService.js');
                if (response.ok) {
                    output.innerHTML = '<div class="status success">✅ Telegram Service file accessible</div>';
                } else {
                    throw new Error('Cannot access Telegram Service');
                }
            } catch (error) {
                output.innerHTML = `<div class="status error">❌ Telegram Service test failed: ${error.message}</div>`;
            }
        }

        async function testSchedulerService() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<div class="status">Testing Scheduler Service...</div>';
            
            try {
                const response = await fetch('/src/services/telegramScheduler.js');
                if (response.ok) {
                    output.innerHTML = '<div class="status success">✅ Telegram Scheduler service accessible</div>';
                } else {
                    throw new Error('Cannot access Scheduler Service');
                }
            } catch (error) {
                output.innerHTML = `<div class="status error">❌ Scheduler Service test failed: ${error.message}</div>`;
            }
        }

        async function testFirebaseConnection() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<div class="status">Testing Firebase Connection...</div>';
            
            try {
                // Basic check - try to access a public endpoint
                output.innerHTML = '<div class="status success">✅ Firebase config check (manual verification required)</div>';
            } catch (error) {
                output.innerHTML = `<div class="status error">❌ Firebase test failed: ${error.message}</div>`;
            }
        }

        // Auto-run basic checks on page load
        window.addEventListener('load', () => {
            console.log('🤖 Telegram Auto-Scheduler Test Page Loaded');
            console.log('🔍 Use the buttons above to run quick tests');
            console.log('📋 Follow the testing guide for complete validation');
        });
    </script>
</body>
</html>
