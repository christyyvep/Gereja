<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test MyRajawali Bot - READY TO USE!</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .success-banner {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .info-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .result {
            background: #e9ecef;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            border-radius: 0 8px 8px 0;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        h1, h2 {
            color: #333;
        }
        
        .emoji {
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-banner">
            <h1>üéâ MyRajawali Bot - READY TO USE!</h1>
            <p>Konfigurasi berhasil! Bot siap mengirim notifikasi</p>
        </div>
        
        <div class="info-grid">
            <div class="info-card">
                <h4>ü§ñ Bot Name</h4>
                <div>GPdI Rajawali Kanonang</div>
            </div>
            <div class="info-card">
                <h4>üë§ Username</h4>
                <div>@MyRajawali_bot</div>
            </div>
            <div class="info-card">
                <h4>üí¨ Chat ID</h4>
                <div>5929124699</div>
            </div>
            <div class="info-card">
                <h4>üì± Chat Type</h4>
                <div>Private Chat</div>
            </div>
            <div class="info-card">
                <h4>üë§ User</h4>
                <div>Anitha Gerungan</div>
            </div>
            <div class="info-card">
                <h4>‚úÖ Status</h4>
                <div>CONFIGURED</div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>üß™ Test Notifications</h2>
        <p>Test semua jenis notifikasi untuk memastikan bot bekerja dengan baik:</p>
        
        <button class="test-button" onclick="testWelcome()">
            üéâ Send Welcome Message
        </button>
        
        <button class="test-button" onclick="testLogin()">
            üîê Test Login Success
        </button>
        
        <button class="test-button" onclick="testFailedLogin()">
            ‚ö†Ô∏è Test Failed Login
        </button>
        
        <button class="test-button" onclick="testSecurity()">
            üö® Test Security Alert
        </button>
        
        <div id="testResults"></div>
    </div>

    <div class="container">
        <h2>üìä Integration Status</h2>
        
        <div class="warning">
            <strong>‚úÖ Setup Complete:</strong>
            <ul>
                <li>‚úÖ Bot Token dikonfigurasi di .env</li>
                <li>‚úÖ Chat ID berhasil didapat dan dikonfigurasi</li>
                <li>‚úÖ Enhanced service ter-obfuscate tersedia</li>
                <li>‚úÖ Environment service simple tersedia</li>
                <li>‚úÖ LoginPage terintegrasi dengan notifikasi</li>
                <li>‚úÖ auth-hybrid.js terintegrasi dengan notifikasi</li>
            </ul>
        </div>
        
        <div class="info-card">
            <h4>üöÄ Ready for Production</h4>
            <p>Sistem notifikasi Telegram sudah siap digunakan di production!</p>
            <p><strong>Current Service:</strong> Environment Variables (telegramEnvService.js)</p>
        </div>
    </div>

    <script type="module">
        let telegramService;
        
        async function loadService() {
            try {
                // Load environment service (current active)
                const module = await import('../src/utils/telegramEnvService.js');
                telegramService = module.default;
                console.log('‚úÖ Telegram Environment Service loaded successfully');
                return true;
            } catch (error) {
                console.error('‚ùå Failed to load telegram service:', error);
                showResult(`Error loading service: ${error.message}`, 'error');
                return false;
            }
        }

        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultElement = document.createElement('div');
            resultElement.className = `result ${type}`;
            resultElement.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(resultElement);
            
            // Scroll to latest result
            resultElement.scrollIntoView({ behavior: 'smooth' });
        }

        // Global test functions
        window.testWelcome = async function() {
            showResult('Sending welcome message...', 'info');
            
            const loaded = await loadService();
            if (!loaded) return;

            try {
                const result = await telegramService.notifyCustom(
                    `üéâ SELAMAT DATANG MyRajawali Bot!\\n\\n` +
                    `‚úÖ Konfigurasi berhasil\\n` +
                    `ü§ñ Bot: @MyRajawali_bot\\n` +
                    `üèõÔ∏è Gereja: GPdI Rajawali Kanonang\\n` +
                    `üë§ Chat: Anitha Gerungan\\n\\n` +
                    `Bot siap melayani notifikasi MyRajawali! üöÄ`
                );
                
                showResult(
                    `Welcome message: ${result ? 'SUCCESS - Check your Telegram!' : 'FAILED'}`, 
                    result ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`Welcome test error: ${error.message}`, 'error');
            }
        };

        window.testLogin = async function() {
            showResult('Testing login success notification...', 'info');
            
            const loaded = await loadService();
            if (!loaded) return;

            try {
                const result = await telegramService.notifyLogin({
                    username: 'Anitha Gerungan',
                    email: 'anitha@gpdirajawali.com',
                    role: 'jemaat',
                    ip: '192.168.1.100'
                });
                
                showResult(
                    `Login notification: ${result ? 'SUCCESS - Check your Telegram!' : 'FAILED'}`, 
                    result ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`Login test error: ${error.message}`, 'error');
            }
        };

        window.testFailedLogin = async function() {
            showResult('Testing failed login notification...', 'info');
            
            const loaded = await loadService();
            if (!loaded) return;

            try {
                const result = await telegramService.notifyFailedLogin({
                    email: 'hacker@suspicious.com',
                    reason: 'Invalid password attempt',
                    ip: '192.168.1.200',
                    attempts: 3,
                    maxAttempts: 5
                });
                
                showResult(
                    `Failed login notification: ${result ? 'SUCCESS - Check your Telegram!' : 'FAILED'}`, 
                    result ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`Failed login test error: ${error.message}`, 'error');
            }
        };

        window.testSecurity = async function() {
            showResult('Testing security alert...', 'info');
            
            const loaded = await loadService();
            if (!loaded) return;

            try {
                const result = await telegramService.notifySecurityAlert({
                    type: 'Suspicious Activity Detected',
                    email: 'suspicious@activity.com',
                    ip: '10.0.0.1',
                    details: 'Multiple failed login attempts from unusual location'
                });
                
                showResult(
                    `Security alert: ${result ? 'SUCCESS - Check your Telegram!' : 'FAILED'}`, 
                    result ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`Security test error: ${error.message}`, 'error');
            }
        };

        // Auto-load service and send welcome on page load
        loadService().then(() => {
            console.log('üéâ MyRajawali Bot Test Page Ready!');
            console.log('ü§ñ Bot: @MyRajawali_bot (GPdI Rajawali Kanonang)');
            console.log('üí¨ Chat ID: 5929124699');
            console.log('üë§ User: Anitha Gerungan');
        });
    </script>
</body>
</html>
